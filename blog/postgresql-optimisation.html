<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimisation PostgreSQL : De 30s √† 0.2s - Klyon</title>
    <meta name="description" content="Guide technique d'optimisation PostgreSQL avec techniques d'indexation, EXPLAIN ANALYZE et bonnes pratiques.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="../minilogo.jpg">
    
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .blog-article {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.8;
        }
        
        .blog-article h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .blog-article .meta {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .blog-article .meta span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            color: var(--accent-color);
            transform: translateX(-5px);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../index.html">
                    <img src="../logo.jpg" alt="Klyon Logo" class="logo-img">
                </a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="../index.html#accueil" class="nav-link">Accueil</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#services" class="nav-link">Services</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#competences" class="nav-link">Comp√©tences</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#apropos" class="nav-link">√Ä propos</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#projets" class="nav-link">Projets</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#blog" class="nav-link">Blog</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#contact" class="nav-link">Contact</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="blog-article">
        <a href="../index.html#blog" class="back-link">
            <i class="fas fa-arrow-left"></i> Retour au blog
        </a>
        
        <h1>Optimisation PostgreSQL : De 30s √† 0.2s</h1>
        
        <div class="meta">
            <span><i class="fas fa-calendar"></i> 20 Ao√ªt 2024</span>
            <span><i class="fas fa-clock"></i> 15 min de lecture</span>
            <span><i class="fas fa-tag"></i> PostgreSQL</span>
        </div>
        
        <p>Comment j'ai optimis√© un syst√®me de reporting lent en r√©√©crivant des requ√™tes complexes. Techniques d'indexation, EXPLAIN ANALYZE et bonnes pratiques PostgreSQL.</p>
        
        <h2>Le d√©fi : Requ√™te de 30 secondes</h2>
        
        <p><strong>Client :</strong> Entreprise de logistique (Marseille)</p>
        <p><strong>Probl√®me :</strong> Rapport de ventes mensuel prenait 30 secondes √† s'ex√©cuter</p>
        <p><strong>Impact :</strong> Blocage de l'interface utilisateur, frustration des √©quipes</p>
        
        <h2>Analyse initiale avec EXPLAIN ANALYZE</h2>
        
        <p>La requ√™te probl√©matique :</p>
        
        <div class="code-block">
            <pre><code>SELECT 
    c.nom_client,
    p.nom_produit,
    SUM(v.quantite) as total_ventes,
    SUM(v.prix * v.quantite) as chiffre_affaires
FROM ventes v
JOIN clients c ON v.client_id = c.id
JOIN produits p ON v.produit_id = p.id
WHERE v.date_vente >= '2024-01-01'
    AND v.date_vente < '2024-02-01'
    AND c.region = 'PACA'
GROUP BY c.nom_client, p.nom_produit
ORDER BY chiffre_affaires DESC;</code></pre>
        </div>
        
        <p><strong>R√©sultat EXPLAIN ANALYZE :</strong></p>
        <ul>
            <li>‚è±Ô∏è <strong>Execution Time: 30.245 ms</strong></li>
            <li>üîç <strong>Seq Scan sur ventes</strong> : 2.5M lignes scann√©es</li>
            <li>üîó <strong>Nested Loop</strong> : 2.5M √ó 2.5M op√©rations</li>
            <li>üíæ <strong>Buffer hits: 0</strong> (tout en lecture disque)</li>
        </ul>
        
        <!-- Paywall Overlay -->
        <div id="paywall-overlay" class="paywall-overlay">
            <div class="paywall-content">
                <div class="paywall-icon">
                    <i class="fas fa-database"></i>
                </div>
                <h3>Article Premium</h3>
                <p>Cet article contient des techniques avanc√©es d'optimisation PostgreSQL, des requ√™tes SQL optimis√©es et des configurations de performance.</p>
                
                <div class="paywall-benefits">
                    <h4>Ce que vous d√©couvrirez :</h4>
                    <ul>
                        <li><i class="fas fa-check"></i> Techniques d'indexation avanc√©es</li>
                        <li><i class="fas fa-check"></i> Requ√™tes SQL optimis√©es</li>
                        <li><i class="fas fa-check"></i> Configuration PostgreSQL</li>
                        <li><i class="fas fa-check"></i> Vues mat√©rialis√©es</li>
                        <li><i class="fas fa-check"></i> Monitoring et maintenance</li>
                        <li><i class="fas fa-check"></i> Bonnes pratiques de performance</li>
                    </ul>
                </div>
                
                <div class="paywall-cta">
                    <a href="../index.html#contact" class="btn btn-primary">
                        <i class="fas fa-envelope"></i> Demander l'article complet
                    </a>
                    <a href="../index.html#competences" class="btn btn-secondary">
                        <i class="fas fa-code"></i> Voir mes comp√©tences
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Premium Content (Blurred) -->
        <div id="premium-content" class="premium-content">
        
        <h2>Strat√©gie d'optimisation</h2>
        
        <h3>1. Cr√©ation d'index strat√©giques</h3>
        
        <div class="code-block">
            <pre><code>-- Index composite pour la requ√™te principale
CREATE INDEX idx_ventes_date_client_produit 
ON ventes (date_vente, client_id, produit_id) 
INCLUDE (quantite, prix);

-- Index sur la r√©gion des clients
CREATE INDEX idx_clients_region 
ON clients (region) 
WHERE region = 'PACA';

-- Index sur les noms pour les JOINs
CREATE INDEX idx_clients_nom ON clients (id, nom_client);
CREATE INDEX idx_produits_nom ON produits (id, nom_produit);</code></pre>
        </div>
        
        <h3>2. Optimisation de la requ√™te</h3>
        
        <div class="code-block">
            <pre><code>-- Requ√™te optimis√©e avec CTE
WITH ventes_paca AS (
    SELECT v.client_id, v.produit_id, v.quantite, v.prix
    FROM ventes v
    INNER JOIN clients c ON v.client_id = c.id
    WHERE v.date_vente >= '2024-01-01'
        AND v.date_vente < '2024-02-01'
        AND c.region = 'PACA'
)
SELECT 
    c.nom_client,
    p.nom_produit,
    SUM(vp.quantite) as total_ventes,
    SUM(vp.prix * vp.quantite) as chiffre_affaires
FROM ventes_paca vp
INNER JOIN clients c ON vp.client_id = c.id
INNER JOIN produits p ON vp.produit_id = p.id
GROUP BY c.nom_client, p.nom_produit
ORDER BY chiffre_affaires DESC;</code></pre>
        </div>
        
        <h3>3. Configuration PostgreSQL</h3>
        
        <div class="code-block">
            <pre><code>-- Optimisation des param√®tres
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';
ALTER SYSTEM SET work_mem = '16MB';
ALTER SYSTEM SET maintenance_work_mem = '64MB';

-- Red√©marrage du service
SELECT pg_reload_conf();</code></pre>
        </div>
        
        <h2>R√©sultats obtenus</h2>
        
        <p><strong>Nouveau EXPLAIN ANALYZE :</strong></p>
        <ul>
            <li>‚ö° <strong>Execution Time: 0.198 ms</strong> (150x plus rapide !)</li>
            <li>üéØ <strong>Index Scan</strong> : Seulement 50K lignes scann√©es</li>
            <li>üíæ <strong>Buffer hits: 100%</strong> (tout en m√©moire)</li>
            <li>üìä <strong>Planning time: 0.1ms</strong></li>
        </ul>
        
        <h2>Techniques avanc√©es utilis√©es</h2>
        
        <h3>Index partiels</h3>
        <div class="code-block">
            <pre><code>-- Index partiel pour les donn√©es r√©centes
CREATE INDEX idx_ventes_recentes 
ON ventes (date_vente, client_id) 
WHERE date_vente >= '2024-01-01';</code></pre>
        </div>
        
        <h3>Vues mat√©rialis√©es</h3>
        <div class="code-block">
            <pre><code>-- Vue mat√©rialis√©e pour les rapports fr√©quents
CREATE MATERIALIZED VIEW mv_ventes_mensuelles AS
SELECT 
    DATE_TRUNC('month', date_vente) as mois,
    c.region,
    SUM(prix * quantite) as ca_total
FROM ventes v
JOIN clients c ON v.client_id = c.id
GROUP BY DATE_TRUNC('month', date_vente), c.region;

-- Index sur la vue mat√©rialis√©e
CREATE INDEX idx_mv_ventes_mois_region 
ON mv_ventes_mensuelles (mois, region);</code></pre>
        </div>
        
        <h3>Analyse des statistiques</h3>
        <div class="code-block">
            <pre><code>-- Mise √† jour des statistiques
ANALYZE ventes;
ANALYZE clients;
ANALYZE produits;

-- V√©rification des statistiques
SELECT schemaname, tablename, n_tup_ins, n_tup_upd, n_tup_del
FROM pg_stat_user_tables
WHERE tablename IN ('ventes', 'clients', 'produits');</code></pre>
        </div>
        
        <h2>Bonnes pratiques PostgreSQL</h2>
        
        <ol>
            <li><strong>Index composites</strong> : Cr√©er des index sur les colonnes utilis√©es dans WHERE et JOIN</li>
            <li><strong>INCLUDE columns</strong> : √âviter les lookups suppl√©mentaires</li>
            <li><strong>Index partiels</strong> : Pour les requ√™tes sur des sous-ensembles</li>
            <li><strong>Vues mat√©rialis√©es</strong> : Pour les rapports complexes r√©currents</li>
            <li><strong>Configuration m√©moire</strong> : Ajuster selon la RAM disponible</li>
        </ol>
        
        <h2>Monitoring continu</h2>
        
        <div class="code-block">
            <pre><code>-- Requ√™te pour identifier les requ√™tes lentes
SELECT 
    query,
    calls,
    total_time,
    mean_time,
    rows
FROM pg_stat_statements
WHERE mean_time > 1000  -- Plus de 1 seconde
ORDER BY mean_time DESC
LIMIT 10;</code></pre>
        </div>
        
        <div class="cta-section">
            <h3>üöÄ Besoin d'optimiser vos bases de donn√©es ?</h3>
            <p>Chaque base de donn√©es a ses sp√©cificit√©s. Contactez-moi pour une analyse personnalis√©e et des optimisations sur-mesure.</p>
            <a href="../index.html#contact" class="btn">Discuter de votre projet</a>
        </div>
        </div> <!-- End premium-content -->
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Klyon</h3>
                    <p>Votre partenaire informatique dans le Sud de la France</p>
                </div>
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="../index.html#services">Support Informatique</a></li>
                        <li><a href="../index.html#services">D√©veloppement Sur-Mesure</a></li>
                        <li><a href="../index.html#services">Intelligence Artificielle</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <ul>
                        <li><a href="mailto:klyonme@gmail.com">klyonme@gmail.com</a></li>
                        <li><a href="tel:+33766980342">07 66 98 03 42</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Klyon. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

    <script src="../script.js"></script>
    
    <!-- Paywall Styles -->
    <style>
        .paywall-overlay {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }
        
        .paywall-content {
            position: relative;
            z-index: 2;
        }
        
        .paywall-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }
        
        .paywall-benefits {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: left;
        }
        
        .paywall-benefits ul {
            list-style: none;
            padding: 0;
        }
        
        .paywall-benefits li {
            display: flex;
            align-items: center;
            margin: 0.8rem 0;
            color: rgba(255,255,255,0.9);
        }
        
        .paywall-benefits i {
            color: #4ade80;
            margin-right: 0.8rem;
            font-size: 1.2rem;
        }
        
        .paywall-cta {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .btn-primary:hover, .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .premium-content {
            filter: blur(8px);
            pointer-events: none;
            user-select: none;
            position: relative;
        }
        
        .premium-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
            z-index: 1;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @media (max-width: 768px) {
            .paywall-cta {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-primary, .btn-secondary {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
    
    <!-- Paywall Protection Script -->
    <script>
        // Protection contre l'inspection
        (function() {
            'use strict';
            
            // D√©tection des DevTools
            let devtools = {open: false, orientation: null};
            const threshold = 160;
            
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.clear();
                        console.log('%cüö´ Acc√®s refus√©', 'color: #ff0000; font-size: 20px; font-weight: bold;');
                        console.log('%cLe contenu premium est prot√©g√©', 'color: #ff0000; font-size: 14px;');
                        console.log('%cContactez-moi pour acc√©der √† l\'article complet', 'color: #ff0000; font-size: 12px;');
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);
            
            // Blocage des interactions sur le contenu premium
            const premiumContent = document.getElementById('premium-content');
            if (premiumContent) {
                // Bloquer la s√©lection
                premiumContent.addEventListener('selectstart', function(e) {
                    e.preventDefault();
                    return false;
                });
                
                // Bloquer le clic droit
                premiumContent.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });
                
                // Bloquer les raccourcis clavier
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'F12' || 
                        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                        (e.ctrlKey && e.key === 'U')) {
                        e.preventDefault();
                        console.log('%cüö´ Acc√®s refus√© - Contenu prot√©g√©', 'color: #ff0000; font-size: 16px; font-weight: bold;');
                        return false;
                    }
                });
                
                // Bloquer la copie
                premiumContent.addEventListener('copy', function(e) {
                    e.preventDefault();
                    return false;
                });
            }
            
            // Animation du paywall
            const paywallOverlay = document.getElementById('paywall-overlay');
            if (paywallOverlay) {
                setInterval(function() {
                    paywallOverlay.style.boxShadow = '0 20px 40px rgba(102,126,234,0.3)';
                    setTimeout(function() {
                        paywallOverlay.style.boxShadow = '0 20px 40px rgba(0,0,0,0.1)';
                    }, 1000);
                }, 3000);
            }
            
            // Tracking des clics sur les boutons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.paywall-cta a')) {
                    // Google Analytics tracking (si disponible)
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'paywall_click', {
                            'event_category': 'engagement',
                            'event_label': 'postgresql_article'
                        });
                    }
                }
            });
        })();
    </script>
</body>
</html>
